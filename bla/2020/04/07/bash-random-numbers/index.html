<!DOCTYPE html>
<html lang="en">

	<head>
	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

	<!-- custom css AFTER bootstrap -->
	<link href="https://fonts.googleapis.com/css?family=Noto+Serif&amp;subset=greek-ext,latin-ext" rel="stylesheet">
	<link rel="stylesheet" href="/assets/css/cover.css">
	<link rel="stylesheet" href="/assets/css/solarized-dark.css">

	<link rel="icon" type="image/png" href="/assets/favicon.png">
	<title>Random numbers from /dev/urandom in Bash</title>
	<meta name="description" content="">

	<!-- Facebook/Twitter/SEO -->
	<meta property="og:title" content="Random numbers from /dev/urandom in Bash"/>
	<meta property="og:image" content="https://heitorpb.github.io/assets/imgs/me.jpg"/>
	<meta property="og:url" content="https://heitorpb.github.io/bla/2020/04/07/bash-random-numbers/"/>
	<meta property="og:type" content="article">
	<meta property="og:site_name" content="Heitor's log"/>
	<meta property="og:description" content="Yeaah"/>

	<meta name="twitter:card" content="summary">
	<meta name="twitter:site" content="">
	<meta name="twitter:title" content="Random numbers from /dev/urandom in Bash" />
	<meta name="twitter:image" content="https://heitorpb.github.io/assets/imgs/me.jpg" />
	<meta name="twitter:url" content="https://heitorpb.github.io/bla/2020/04/07/bash-random-numbers/" />
	<meta name="twitter:description" content="Yeaah" />

	<link rel="sitemap" type="application/xml" title="Sitemap" href="https://heitorpb.github.io/sitemap.xml" />
	<link rel="alternate" type="application/rss+xml" href="https://heitorpb.github.io/feed.xml">
</head>


	<body>
		<div id="wrapper">

			<div class="cover-container d-flex w-100 h-100 p-3 mx-auto flex-column">
	<header class="masthead mb-auto">
		<div class="inner">
			<h3 class="masthead-brand">Heitor&#39;s log</h3>
			<nav class="nav nav-masthead justify-content-center">
				<a class="nav-link "    href="/"             >Home</a>
				<a class="nav-link "       href="/me.html"      >Me</a>
				<a class="nav-link " href="/projects.html">Projects</a>
				<a class="nav-link active"     href="/bla/"         >Bla</a>
			</nav>
		</div>
	</header>


			<main role="main" class="inner cover">
				<br>
				<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
	<header class="post-header">
		<h1 class="post-title p-name" itemprop="name headline">Random numbers from /dev/urandom in Bash</h1>
		<p class="post-meta">
			<time class="dt-published" datetime="2020-04-07T00:00:00-03:00" itemprop="datePublished">Apr 07, 2020
			</time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Heitor</span></span></p>
	</header>

	<br>

	<div class="post-content e-content" itemprop="articleBody">
		<p>In a GNU/Linux distributions, there are special files (<code class="highlighter-rouge">/dev/random</code> and
<code class="highlighter-rouge">/dev/urandom</code>) to access the kernel’s random number generator. But how
do we get random numbers from them in a bash script?</p>

<p>If we try to <code class="highlighter-rouge">cat</code> them we get random things:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat</span> /dev/random
XB&gt;7<span class="p">;</span>Mq<span class="s1">'\'</span><span class="nv">$,</span>dH՞ՈT<span class="o">=</span>H<span class="o">}</span>0]eS19Ѡ
Hd9<span class="o">)</span>7ܢVO<span class="s1">'y.ۧMW^C
</span></code></pre></div></div>

<p>Something a bit weirder happens with <code class="highlighter-rouge">/dev/urandom</code>: it continues vomiting
characters really fast at you until you stop it with <code class="highlighter-rouge">Ctrl + C</code>.</p>

<p>What’s the difference between <code class="highlighter-rouge">/dev/random</code> and <code class="highlighter-rouge">/dev/urandom</code>? Lets check the
manpage for <code class="highlighter-rouge">random (4)</code>, as of Linux 5.6:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   The  random number generator gathers environmental noise from device driv‐
   ers and other sources into an entropy pool.  The generator also  keeps  an
   estimate  of  the  number of bits of noise in the entropy pool.  From this
   entropy pool, random numbers are created.

   When read, the /dev/urandom device returns random bytes using a pseudoran‐
   dom number generator seeded from the entropy pool.  Reads from this device
   do not block (i.e., the CPU is not yielded), but can incur an  appreciable
   delay when requesting large amounts of data.

   The  /dev/random  device  is a legacy interface which dates back to a time
   where  the  cryptographic  primitives  used  in  the   implementation   of
   /dev/urandom  were  not  widely trusted.  It will return random bytes only
   within the estimated number of bits of fresh noise in  the  entropy  pool,
   blocking if necessary.  /dev/random is suitable for applications that need
   high quality randomness, and can afford indeterminate delays.

   When the entropy pool is empty, reads from /dev/random  will  block  until
   additional  environmental  noise  is  gathered. (...)
</code></pre></div></div>

<p>From this, we get that:</p>

<ul>
  <li>the Kernel maintains a pool of entropy from random things that happens in the
computer.</li>
  <li>both special files use this entropy pool to seed a <abbr title="pseudorandom number generator">PRNG</abbr>.</li>
  <li><code class="highlighter-rouge">/dev/random</code> waits until there are enough randomness to output something.</li>
  <li><code class="highlighter-rouge">/dev/urandom</code> is preferred.</li>
  <li>both files gives us <em>bytes</em>.</li>
</ul>

<p>And from the Kernel’s source we get that <code class="highlighter-rouge">urandom</code> uses
<a href="https://en.wikipedia.org/wiki/Salsa20#ChaCha_variant">ChaCha20</a> as <abbr title="cryptographiccally secure pseudorandom number generator">CSPRNG</abbr>.
<sup id="fnref:kernel-source"><a href="#fn:kernel-source" class="footnote">1</a></sup></p>

<p>We now need a tool to read a specific number of bytes from those files and
convert it to something human readable. And here comes <code class="highlighter-rouge">od</code>, a Unix
command to display data in several formats.<sup id="fnref:od"><a href="#fn:od" class="footnote">2</a></sup> The default is octal, hence the
name <code class="highlighter-rouge">od</code>: <em>octal dump</em>.</p>

<p>With this utility we can read <code class="highlighter-rouge">N</code> bytes from a file and display it in a
specified format. For example, here’s the dump of `Hello World”:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">echo </span>Hello World | <span class="nb">od
</span>0000000 062510 066154 020157 067527 066162 005144
0000014
</code></pre></div></div>

<p>The first column is the offset, and then the octal representation of that line.
So, the second line of the output means: starting at the offset <code class="highlighter-rouge">0000014</code> we
have nothing, i.g. there are 14 (in octal, or 12 in decimal) characters in that
string.</p>

<p>It looks like <code class="highlighter-rouge">od</code> does not know how to count. There are 11 chars in <code class="highlighter-rouge">Hello
World</code>! Lets see each char individually (<code class="highlighter-rouge">-c</code>) in octal (<code class="highlighter-rouge">-b</code>):</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"Hello World"</span> | <span class="nb">od</span> <span class="nt">-cb</span>
0000000   H   e   l   l   o       W   o   r   l   d  <span class="se">\n</span>
        110 145 154 154 157 040 127 157 162 154 144 012
0000014
</code></pre></div></div>

<p>Sweet, it counted the line ending as well.</p>

<p><code class="highlighter-rouge">od</code> can also read <code class="highlighter-rouge">N</code> bytes from a source and display it in a specified
format. So, to read 4 bytes from <code class="highlighter-rouge">/dev/urandom</code>, display it as an unsigned
integer without the offset column:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">od</span> <span class="nt">-vAn</span> <span class="nt">-N4</span> <span class="nt">-t</span> u4 &lt; /dev/urandom
  402803061
</code></pre></div></div>

<p>And to use in your bash code:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for </span>i <span class="k">in</span> <span class="k">$(</span><span class="nb">seq </span>1 10<span class="k">)</span>
<span class="k">do
	</span><span class="nv">random</span><span class="o">=</span><span class="k">$(</span><span class="nb">od</span> <span class="nt">-vAn</span> <span class="nt">-N4</span> <span class="nt">-t</span> u4 &lt; /dev/urandom<span class="k">)</span>
	<span class="nb">echo</span> <span class="nv">$random</span>
<span class="k">done</span>
</code></pre></div></div>

<p>With this code, those 32 bits (4 bytes) from <code class="highlighter-rouge">urandom</code> are interpreted as an
integer. How do we get floats? If interested only in the range <code class="highlighter-rouge">[0, 1)</code>: simply
divide by the greatest possible value, \( 2^{32} - 1\).</p>

<div class="footnotes">
  <ol>
    <li id="fn:kernel-source">
      <p><a href="https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/char/random.c?h=v5.6.2&amp;id=4aa37c463764052c68c5c430af2a67b5d784c1e0">file <code class="highlighter-rouge">drivers/char/random.c</code></a> <a href="#fnref:kernel-source" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:od">
      <p><a href="https://www.gnu.org/software/coreutils/manual/html_node/od-invocation.html">Gnu Coreutils</a> <a href="#fnref:od" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

	</div>

	<a class="u-url" href="/bla/2020/04/07/bash-random-numbers/" hidden></a>
</article>
				<br>
			</main>

				<footer class="mastfoot mt-auto text-center">
		<div class="inner">
			
			<br />Heitor's log, 2018 - 2020
			by <a href="/me.html">Heitor</a>
			is licensed under a
			<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0 International License</a>.
		</div>
	</footer>
</div>
			<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

		</div>
	</body>
</html>